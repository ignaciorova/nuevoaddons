<odoo>
  <data>
    <record id="ai_agent_list" model="ir.ui.view">
      <field name="name">ai.agent.list</field>
      <field name="model">ai.agent</field>
      <field name="arch" type="xml">
        <!-- #if VERSION >= "18.0" -->
        <list string="AI Agents" decoration-info="status=='draft'" decoration-success="status=='active'" decoration-muted="status=='done'" decoration-danger="status=='error'" multi_edit="1">
          <field name="name" />
          <field name="ai_type" />
          <field name="ai_agent_llm_id" />
          <field name="ai_role" optional="show" />
          <field name="ai_temperature" optional="hide" />
          <field name="object_id" optional="hide" />
          <field name="session_count" optional="hide" />
          <field name="session_line_count" optional="hide" />
          <field name="quest_count" optional="hide" />
          <field name="last_run" optional="show" />
          <field name="status" widget="badge" decoration-info="status == 'draft'" decoration-success="status == 'active'" decoration-muted="status == 'done'" decoration-danger="status == 'error'" />
          <field name="is_favorite" widget="boolean_favorite" optional="hide" />
          <field name="debug" optional="hide" />
          <field name="company_id" groups="base.group_multi_company" />
        </list>
        <!-- #elif VERSION <= "17.0" -->
        <tree string="AI Agents" decoration-info="status=='draft'" decoration-success="status=='active'" decoration-muted="status=='done'" decoration-danger="status=='error'" multi_edit="1">
          <field name="name" />
          <field name="ai_type" />
          <field name="ai_agent_llm_id" />
          <field name="ai_role" optional="show" />
          <field name="ai_temperature" optional="hide" />
          <field name="object_id" optional="hide" />
          <field name="session_count" optional="hide" />
          <field name="session_line_count" optional="hide" />
          <field name="quest_count" optional="hide" />
          <field name="last_run" optional="show" />
          <field name="status" widget="badge" decoration-info="status == 'draft'" decoration-success="status == 'active'" decoration-muted="status == 'done'" decoration-danger="status == 'error'" />
          <field name="is_favorite" widget="boolean_favorite" optional="hide" />
          <field name="debug" optional="hide" />
          <field name="company_id" groups="base.group_multi_company" />
        </tree>
        <!-- #endif -->
      </field>
    </record>
    <record id="ai_agent_search" model="ir.ui.view">
      <field name="name">ai.agent.search</field>
      <field name="model">ai.agent</field>
      <field name="arch" type="xml">
        <search string="Search AI Agents">
          <field name="name" />
          <field name="ai_agent_llm_id" />
          <field name="ai_temperature" />
          <field name="ai_role" />
          <field name="ai_type" />
          <field name="ai_description" />
          <field name="ai_goal" />
          <field name="ai_backstory" />
          <field name="company_id" groups="base.group_multi_company" />
          <!-- #if VERSION >= "16.0" -->
          <field name="tag_ids" />
          <!-- #endif -->
          <field name="object_id" />
          <filter string="Favorite" name="favorite" domain="[('is_favorite', '=', True)]" />
          <filter string="Global Company" name="company" domain="[('company_id', '=', False)]" />
          <group expand="0" string="Group By">
            <filter string="AI Agent LLM" name="group_by_llm" context="{'group_by': 'ai_agent_llm_id'}" />
            <filter string="AI Type" name="group_by_type" context="{'group_by': 'ai_type'}" />
            <filter string="Company" name="group_by_company_id" context="{'group_by': 'company_id'}" />
          </group>
        </search>
      </field>
    </record>
    <record id="ai_agent_form" model="ir.ui.view">
      <field name="name">ai.agent.form</field>
      <field name="model">ai.agent</field>
      <field name="arch" type="xml">
        <form>
          <header>
            <button name="test" type="object" string="Test" />
            <field name="status" widget="statusbar" statusbar_visible="draft,active,done" options="{'clickable': '1', 'fold_field': 'fold'}" />
          </header>
          <sheet>
            <div name="button_box" id="button_box" class="oe_button_box">
              <button name="action_get_quests" class="oe_stat_button " type="object" icon="fa-rocket">
                <field string="Quests" name="quest_count" widget="statinfo" />
              </button>
              <button name="action_get_sessions" class="oe_stat_button" type="object" icon="fa-flag-checkered">
                <field string="Sessions" name="session_count" widget="statinfo" />
              </button>
              <button name="action_get_session_lines" class="oe_stat_button" type="object" icon="fa-money">
                <field string="Tokens" name="session_line_count" widget="statinfo" />
              </button>
            </div>
            <field name="image_128" widget="image" class="oe_avatar" />
            <div class="oe_title">
              <label for="name" string="Name" />
              <h1>
                <field name="name" class="oe_inline" modifiers="{&quot;required&quot;: true}" default_focus="1" placeholder="e.g. support" readonly="0" />
              </h1>
            </div>
            <group>
              <group>
                <field name="ai_type" />
                <field name="object_id" />
                <!-- #if VERSION == 16.0 -->
                <field name="tag_ids" widget="many2many_tags" />
                <!-- #endif -->
                <field name="company_id" groups="base.group_multi_company" />
              </group>
              <group>
                <!-- #if VERSION >= "17.0" -->
                <field name="ai_agent_llm_id" required="status != 'draft'" />
                <!-- #elif VERSION <= "16.0" -->
                <field name="ai_agent_llm_id" attrs="{'required': [('status', '!=', 'draft')]}" />
                <!-- #endif -->
                <field name="has_temperature" invisible="1" />
                <!-- #if VERSION >= "17.0" -->
                <field name="ai_temperature" invisible="not has_temperature" />
                <!-- #elif VERSION <= "16.0" -->
                <field name="ai_temperature" attrs="{'invisible': [('has_temperature', '=', False)]}" />
                <!-- #endif -->
                <field name="last_run" />
              </group>
            </group>
            <group>
              <field name="ai_role" />
              <field name="ai_goal" />
            </group>
            <notebook>
              <page string="Description" id="description">
                <field name="ai_description" nolabel="1" />
              </page>
              <page string="Prompt Template" id="template">
                <field name="ai_prompt_template" widget="html" class="oe-bordered-editor" options="{'style-inline': true, 'codeview': true, 'dynamic_placeholder': true}" nolabel="1" />
              </page>
              <page string="Backstory" id="backstory">
                <field name="ai_backstory" nolabel="1" />
              </page>
              <page string="Memory" id="memory">
                <field name="ai_memory_ids">
                  <!-- #if VERSION >= "18.0" -->
                  <list editable="bottom">
                    <field name="sequence" widget="handle" />
                    <field name="ai_memory_id" />
                    <field name="ai_memory_status" />
                    <field name="ai_memory_llm_id" />
                    <field name="ai_memory_llm_status" />
                    <field name="ai_memory_url" optional='hide' />
                    <field name="last_run" optional='hide' />
                    <field name="nbr_days" optional='hide' />
                    <button name="run" string="Run" type="object" icon="" />
                  </list>
                  <!-- #elif VERSION <= "17.0" -->
                  <tree editable="bottom">
                    <field name="sequence" widget="handle" />
                    <field name="ai_memory_id" />
                    <field name="ai_memory_status" />
                    <field name="ai_memory_llm_id" />
                    <field name="ai_memory_llm_status" />
                    <field name="ai_memory_url" optional='hide' />
                    <field name="last_run" optional='hide' />
                    <field name="nbr_days" optional='hide' />
                    <button name="run" string="Run" type="object" icon="" />
                  </tree>
                  <!-- #endif -->
                </field>
              </page>
              <page string="Tools" id="tool">
                <field name="ai_tool_ids">
                  <!-- #if VERSION >= "18.0" -->
                  <list editable="bottom">
                    <field name="sequence" widget="handle" />
                    <field name="ai_tool_id" nolabel="1" />
                  </list>
                  <!-- #elif VERSION <= "17.0" -->
                  <tree editable="bottom">
                    <field name="sequence" widget="handle" />
                    <field name="ai_tool_id" nolabel="1" />
                  </tree>
                  <!-- #endif -->
                </field>
              </page>
            </notebook>
          </sheet>
          <!-- #if VERSION >= "18.0" -->
          <chatter />
          <!-- #elif VERSION <= "17.0" -->
          <div class="oe_chatter">
            <field name="message_follower_ids" widget="mail_followers" />
            <field name="activity_ids" widget="mail_activity" />
            <field name="message_ids" widget="mail_thread" />
          </div>
          <!-- #endif -->
        </form>
      </field>
    </record>
    <!-- Kanban View -->
    <record id="view_ai_agent_kanban" model="ir.ui.view">
      <field name="name">ai.agent.kanban</field>
      <field name="model">ai.agent</field>
      <field name="arch" type="xml">
        <kanban highlight_color="color" class="o_kanban_mobile">
          <field name="id" />
          <field name="name" />
          <field name="color" />
          <field name="is_favorite" />
          <field name="status" />
          <field name="ai_type" />
          <field name="ai_role" />
          <field name="last_run" />
          <field name="object_id" />
          <field name="status_color" />
          <field name="ai_description" />
          <templates>
            <!-- #if VERSION >= "18.0" -->
            <t t-name="menu">
              <t t-if="widget.editable">
                <a role="menuitem" type="open" class="dropdown-item">Edit</a>
              </t>
              <t t-if="widget.deletable">
                <a role="menuitem" type="delete" class="dropdown-item">Delete</a>
              </t>
              <field name="color" widget="kanban_color_picker" />
            </t>
            <t t-name="card" class="flex-row">
              <div class="col-2 me-2">
                <field name="base_image_128" alt="Agent Image" widget="image" options="{'img_class': 'object-fit-cover'}" />
              </div>
              <main t-attf-class="ms-2 oe_kanban_card oe_kanban_global_click oe_kanban_color_#{record.color.raw_value} ">
                <div class="col-9" >
                  <div class="o_project_kanban_main d-flex align-items-baseline gap-1">
                    <div class="o_text_overflow d-flex align-items-center">
                      <field name="is_favorite" widget="boolean_favorite" nolabel="1" force_save="1" style="margin-right: 5px;" />
                      <field class="fw-bold fs-5" name="name" />
                    </div>
                  </div>
                  <div xclass="o_project_kanban_main d-flex align-items-baseline gap-1">
                      <t t-esc="record.ai_description.raw_value.slice(0,45)" />
                  </div>
                </div>
                <div class="o_text_overflow d-flex align-items-center">
                  <field name="ai_type" widget="label_selection" options="{'classes': {'default': 'default'}}" />
                </div>
                <field name="company_id" groups="base.group_multi_company" />
                <div class="d-flex mt-auto align-items-center">
                  <field name="ai_agent_llm_id" class="me-2 o_text_overflow" />
                  <field name="company_id" groups="base.group_multi_company" />
                </div>
                <footer>
                  <div class="d-flex justify-content-between align-items-center w-100">
                    <div class="d-flex align-items-center">
                      <span class="fa fa-clock-o me-2" title="Dates" />
                      <field name="last_run" t-if="record.last_run.value != False" />
                    </div>
                    <span t-att-class="'o_status_bubble mx-0 o_color_bubble_' + record.status_color.value" t-att-title="record.status.value" />
                  </div>
                </footer>
              </main>
            </t>
            <!-- #elif VERSION <= "17.0" -->
            <t t-name="kanban-box">
              <div t-attf-class="oe_kanban_global_click o_ai_agent_kanban #{kanban_color(record.color.raw_value)}">
                <div class="o_kanban_image me-1">
                  <img t-att-src="kanban_image('ai.agent', 'base_image_128', record.id.raw_value)" alt="LLM Agents" class="o_image_64_contain" />
                </div>
                <div class="oe_kanban_details">
                  <div class="o_kanban_record_top mb-0">
                    <div class="o_kanban_record_headings">
                      <span style="margin-right: 5px;">
                        <field name="is_favorite" widget="boolean_favorite" nolabel="1" force_save="1" />
                      </span>
                      <strong class="o_kanban_record_title">
                        <field name="name" />
                      </strong>
                    </div>
                    <div class="o_dropdown_kanban dropdown">
                      <a role="button" class="dropdown-toggle o-no-caret btn" data-toggle="dropdown" href="#" aria-label="Dropdown menu" title="Dropdown menu">
                        <span class="fa fa-ellipsis-v" />
                      </a>
                      <div class="dropdown-menu" role="menu">
                        <t t-if="widget.editable">
                          <a role="menuitem" type="edit" class="dropdown-item">Edit</a>
                        </t>
                        <t t-if="widget.deletable">
                          <a role="menuitem" type="delete" class="dropdown-item">Delete</a>
                        </t>
                      </div>
                    </div>
                  </div>
                  <div class="oe_kanban_content flex-grow-1 flex-column">
                    <div class="oe_kanban_details">
                      <div class="oe_kanban_left">
                        <field name="ai_type" widget="label_selection" options="{'classes': {'default': 'default'}}" />
                      </div>
                    </div>
                  </div>
                  <div class="oe_kanban_footer mt-3">
                    <div class="o_kanban_record_bottom">
                      <div class="oe_kanban_bottom_left" />
                      <div class="oe_kanban_bottom_right">
                        <t t-if="record.last_run.value != False">
                          <span class="fa fa-clock-o me-2" title="Dates" />
                          <field name="last_run" />
                          <field name="company_id" groups="base.group_multi_company" />
                        </t>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </t>
            <!-- #endif -->
          </templates>
        </kanban>
      </field>
    </record>
    <!-- Calendar View -->
    <record id="view_ai_agent_calendar" model="ir.ui.view">
      <field name="name">ai.agent.calendar</field>
      <field name="model">ai.agent</field>
      <field name="arch" type="xml">
        <calendar string="AI Agents" date_start="last_run" color="color" mode="month">
          <field name="name" />
          <field name="ai_type" />
          <field name="status" />
          <field name="ai_role" />
        </calendar>
      </field>
    </record>
    <record id="action_ai_agent" model="ir.actions.act_window">
      <field name="name">Agents</field>
      <field name="res_model">ai.agent</field>
      <!-- #if VERSION >= "18.0" -->
      <field name="view_mode">kanban,list,form,calendar</field>
      <!-- #elif VERSION <= "17.0" -->
      <field name="view_mode">kanban,tree,form,calendar</field>
      <!-- #endif -->
    </record>
    <menuitem id="ai_agent.menu_ai_agent_menu_menu" parent="ai_agent.menu_ai_agent_menu" groups="ai_agent.group_ai_agent_manager" name="Agents" action="action_ai_agent" />
    <menuitem id="ai_agent.menu_ai_agent_configuration" parent="ai_agent.menu_ai_agent_root" name="Configuration" groups="group_ai_agent_supervisor" sequence="99" />
  </data>
</odoo>
