<!-- views/whatsapp_order_history_views.xml -->
<odoo>
    <!-- Vista en lista (tree) para historial de pedidos WhatsApp -->
    <record id="whatsapp_order_history_tree_view" model="ir.ui.view">
        <field name="name">sale.order.whatsapp.history.tree</field>
        <field name="model">sale.order</field>
        <field name="arch" type="xml">
            <tree string="WhatsApp Order History" decoration-success="state == 'sale'" decoration-warning="state == 'draft'">
                <field name="name"/>
                <field name="partner_id"/>
                <field name="date_order"/>
                <field name="amount_total"/>
                <field name="state"/>
                <field name="whatsapp_order" invisible="1"/>  <!-- Campo oculto para filtros -->
            </tree>
        </field>
    </record>

    <!-- Acción para abrir la vista de historial -->
    <record id="action_whatsapp_order_history" model="ir.actions.act_window">
        <field name="name">WhatsApp Order History</field>
        <field name="res_model">sale.order</field>
        <field name="view_mode">tree,form</field>
        <field name="view_id" ref="whatsapp_order_history_tree_view"/>
        <field name="domain">[('whatsapp_order', '=', True)]</field>  <!-- Filtra solo pedidos WhatsApp -->
        <field name="context">{'search_default_whatsapp_order': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No hay pedidos WhatsApp aún. Crea uno desde el carrito de compras.
            </p>
        </field>
    </record>

    <!-- Submenú bajo la configuración de WhatsApp -->
    <menuitem id="menu_whatsapp_order_history"
              name="Order History"
              parent="whatsapp_shopping_bot.menu_twilio_whatsapp_config"
              action="action_whatsapp_order_history"
              sequence="10"/>
</odoo>